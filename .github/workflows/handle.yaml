name: Build non-GKI kernels

on:
  workflow_call:
    inputs:
      kversion:
        description: 'Kernel versions'
        required: true
        type: string
      compiler:
        description: 'Compiler'
        required: true
        type: string
      ksu:
        description: 'KernelSU Repository'
        required: true
        type: string
      ksu_branch:
        description: 'KernelSU Branch'
        required: true
        type: string

jobs:
  build-kernel-core:
    name: Build for Kernel ${{ inputs.kversion }}
    runs-on: ubuntu-latest

    steps:
    - name: Checkout source code
      uses: actions/checkout@v4

    - name: Install required dependencies
      run: |
        sudo apt update -y
        sudo apt install bc cpio flex bison aptitude git python-is-python3 tar perl wget aria2 curl lz4 -y
        sudo aptitude install libssl-dev -y

    - name: Build
      run: |
        echo $(pwd)
        bash handle.sh "${{ inputs.compiler }}" "${{ inputs.kversion }}" "${{ inputs.ksu }}" "${{ inputs.ksu_branch }}"